import{u,b as S,j as d,r as T}from"./streaming-BQkSWh89.js";import{u as v,L as q,v as O,b as A}from"./useLooForm-DHURzQBC.js";const $=e=>{if(typeof document>"u")return null;const t=document.getElementById(e);if(!t)return console.error(`Config script with id "${e}" not found`),null;const o=t.textContent??"";if(!o.trim())return console.error(`Config script with id "${e}" is empty`),null;try{return JSON.parse(o)}catch(r){return console.error(`Failed to parse config from script "${e}"`,r),null}},k=(e="loo-create-config")=>{const[t,o]=u(null);return S(()=>{const r=$(e);o(r)},[e]),t},H=e=>{if(!e||typeof e!="object")return{};const t={};return Object.entries(e).forEach(([o,r])=>{if(typeof r=="string")t[o]=r;else if(r&&typeof r=="object"&&"_errors"in r){const i=r._errors;Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&(t[o]=i[0])}}),t},y=()=>{const e=document.querySelector("[data-loo-create-shell]");e&&e instanceof HTMLElement&&(e.style.display="none")},g=(e,t)=>{if(typeof document>"u")return;const o=document.querySelector(e);o&&o instanceof HTMLElement&&o.scrollIntoView({behavior:"smooth",block:"center",...t})},M=e=>{if(typeof document>"u")return;const t=document.querySelector(`[name="${e}"]`);t&&(t.focus({preventScroll:!0}),t.scrollIntoView({behavior:"smooth",block:"center"}))},b=e=>{const t=Object.keys(e)[0];t&&requestAnimationFrame(()=>M(t))},P=e=>{if(!(typeof window>"u")){if(e){window.location.assign(`/admin/loos/${e}?source=create`);return}window.location.assign("/admin/loos")}},D=()=>{const e=k();return e?d(I,{config:e}):d("div",{class:"form-card",children:"Loading create formâ€¦"})},I=({config:e})=>{const{form:t,updateField:o,updateTriState:r,updateOpeningHours:i,updateLocation:w}=v(e.defaults),[C,l]=u("idle"),[j,f]=u({}),[E,m]=u(null);return S(()=>{y()},[]),d(q,{form:t,errors:j,status:C,serverError:E,formId:"loo-create-form",mode:"create",onFieldChange:(c,n)=>o(c,n),onTriStateChange:(c,n)=>{r(c,n)},onOpeningHoursChange:i,onLocationChange:w,onSubmit:async c=>{c.preventDefault(),m(null);const n=O(t);if(!n.success){f(n.errors||{}),l("error"),b(n.errors||{});return}y(),f({}),l("saving");try{const a=await fetch(e.api.create,{method:"POST",headers:{"content-type":"application/json"},credentials:"same-origin",body:JSON.stringify(A(n.data))});if(a.status===401){window.location.href="/admin/login";return}if(!a.ok){const s=await a.json().catch(()=>null),p=s&&typeof s=="object"?s.issues:null;if(p){const h=H(p);f(h),b(h)}const L=s&&typeof s=="object"&&typeof s.message=="string"?s.message:"The API rejected this request.";m(L),l("error"),requestAnimationFrame(()=>g("[data-error-banner]",{block:"center"}));return}const F=await a.json().catch(()=>null);P(F?.id??null)}catch(a){console.error("Failed to submit loo create request",a),m("Unexpected error while saving. Please try again."),l("error"),requestAnimationFrame(()=>g("[data-error-banner]",{block:"center"}))}}})},x=()=>{const e=document.querySelector("[data-loo-create-shell]");e&&e instanceof HTMLElement&&(e.style.display="none")};if(typeof window<"u"){const e=()=>{x();const t=document.getElementById("loo-create-root");if(!t){console.error("Create form root not found");return}T(d(D,{}),t)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}
//# sourceMappingURL=loos-create.js.map

import{u as d,b as S,j as u,r as j}from"./streaming-BQkSWh89.js";import{u as T,L as v,v as q,b as A}from"./useLooForm-DHURzQBC.js";const O=e=>{if(typeof document>"u")return null;const t=document.getElementById(e);if(!t)return console.error(`Config script with id "${e}" not found`),null;const o=t.textContent??"";if(!o.trim())return console.error(`Config script with id "${e}" is empty`),null;try{return JSON.parse(o)}catch(r){return console.error(`Failed to parse config from script "${e}"`,r),null}},I=()=>{const[e,t]=d(null);return S(()=>{const o=O("loo-edit-config");t(o)},[]),e},$=e=>{if(!e||typeof e!="object")return{};const t={};return Object.entries(e).forEach(([o,r])=>{if(typeof r=="string")t[o]=r;else if(r&&typeof r=="object"&&"_errors"in r){const i=r._errors;Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&(t[o]=i[0])}}),t},y=()=>{const e=document.querySelector("[data-loo-edit-shell]");e&&e instanceof HTMLElement&&(e.style.display="none")},g=(e,t)=>{if(typeof document>"u")return;const o=document.querySelector(e);o&&o instanceof HTMLElement&&o.scrollIntoView({behavior:"smooth",block:"center",...t})},k=e=>{if(typeof document>"u")return;const t=document.querySelector(`[name="${e}"]`);t&&(t.focus({preventScroll:!0}),t.scrollIntoView({behavior:"smooth",block:"center"}))},b=e=>{const t=Object.keys(e)[0];t&&requestAnimationFrame(()=>k(t))},H=e=>{typeof window>"u"||window.location.assign(`/admin/loos/${e}?source=edit`)},M=()=>{const e=I();return e?u(P,{config:e}):u("div",{class:"form-card",children:"Loading edit formâ€¦"})},P=({config:e})=>{const{form:t,updateField:o,updateTriState:r,updateOpeningHours:i,updateLocation:E}=T(e.defaults),[w,l]=d("idle"),[C,f]=d({}),[F,m]=d(null);return S(()=>{y()},[]),u(v,{form:t,errors:C,status:w,serverError:F,formId:"loo-edit-form",mode:"edit",onFieldChange:(a,n)=>o(a,n),onTriStateChange:(a,n)=>{r(a,n)},onOpeningHoursChange:i,onLocationChange:E,onSubmit:async a=>{a.preventDefault(),m(null);const n=q(t);if(!n.success){f(n.errors||{}),l("error"),b(n.errors||{});return}y(),f({}),l("saving");try{const c=await fetch(e.api.update,{method:"PUT",headers:{"content-type":"application/json"},credentials:"same-origin",body:JSON.stringify(A(n.data))});if(c.status===401){window.location.href="/admin/login";return}if(!c.ok){const s=await c.json().catch(()=>null),p=s&&typeof s=="object"?s.issues:null;if(p){const h=$(p);f(h),b(h)}const L=s&&typeof s=="object"&&typeof s.message=="string"?s.message:"The API rejected this request.";m(L),l("error"),requestAnimationFrame(()=>g("[data-error-banner]",{block:"center"}));return}H(e.looId)}catch(c){console.error("Failed to submit loo edit request",c),m("Unexpected error while saving. Please try again."),l("error"),requestAnimationFrame(()=>g("[data-error-banner]",{block:"center"}))}}})},D=()=>{const e=document.querySelector("[data-loo-edit-shell]");e&&e instanceof HTMLElement&&(e.style.display="none")};if(typeof window<"u"){const e=()=>{D();const t=document.getElementById("loo-edit-root");if(!t){console.error("Edit form root not found");return}j(u(M,{}),t)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}
//# sourceMappingURL=loos-edit.js.map
